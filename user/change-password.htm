<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <link rel="apple-touch-icon" sizes="180x180" href="images/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="192x192" href="images/android-chrome-192x192.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="images/favicon-32x32.png" />
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />

    <title>Change Password</title>

    <link rel="dns-prefetch" href="https://cdn.tailwindcss.com"/>
    <link rel="preconnect" href="https://cdn.tailwindcss.com" />
    <link rel="preconnect" href="https://cdn.tailwindcss.com" crossorigin/>
	  <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="dns-prefetch" href="https://cdn.jsdelivr.net"/>
    <link rel="preconnect" href="https://cdn.jsdelivr.net" />
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin/>
    <script src="https://cdn.jsdelivr.net/npm/axios@0.27.2/dist/axios.min.js"></script>

    <link rel="preload" href="stylesheets/user.css" as="style">
    <link rel="stylesheet" type="text/css" href="stylesheets/user.css" />

</head>
<body>
  <div id="app" class="container mx-auto text-gray-900">
    <div class="min-h-screen flex flex-col justify-center items-center mx-auto w-auto">
      <div class="shadow-xl p-4 lg:p-8 bg-gray-50 rounded-xl relative -mt-20 w-1/4">
        <div class="text-center mb-4 lg:mb-8">
          <span class="text-xl lg:text-5xl mt-1 text-gray-600 font-bold">CHANGE</span>
        </div>
        <!-- <form id="singnupForm"> -->
          <input type="hidden" name="" value="" />
          <div class="relative text-gray-800 focus-within:text-gray-600 mb-2 lg:mb-6">
            <input type="password" name="old_password" placeholder="Old Password" id="old_password" class="block px-2 lg:px-4 py-1 lg:py-2 w-full rounded bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-600 focus:border-transparent" />
          </div>
          <div class="relative text-gray-800 focus-within:text-gray-600 mb-2 lg:mb-6">
            <input type="password" name="password" placeholder="New Password" id="password" class="block px-2 lg:px-4 py-1 lg:py-2 w-full rounded bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-600 focus:border-transparent" />
          </div>
          <div class="relative text-gray-800 focus-within:text-gray-600 mb-2 lg:mb-6">
            <input type="password" name="confirm-password" placeholder="New Confirm Password" id="confirm_password" class="block px-2 lg:px-4 py-1 lg:py-2 w-full rounded bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-600 focus:border-transparent" />
          </div>
          <div class="items-center text-center">
            <button name="button" id="submit" type="button" class="btn bg-gray-600 hover:bg-gray-500 text-white py-1 lg:py-2 rounded-full w-2/3 inline">Submit</button>
          </div>
        <!-- </form> -->
      </div>
    </div>
  </div>
  <script src="scripts/authcheck.js"></script>
  <script>
"use strict";

function invaildInfo(inputId='',inputEIId='', regex='', message='') {
  var vaildInput = document.getElementById(inputId);
  var input_ei = document.getElementById(inputEIId);
  if (!regex.test(vaildInput.value)) {
    if (input_ei == null) {
      var input_ei = document.createElement('p');
      input_ei.setAttribute('id', inputEIId);
      input_ei.innerText = message;
      vaildInput.parentNode.appendChild(input_ei);
    } else {
      input_ei.innerText = message;
    }
  } else {
    if (input_ei != null) {
      vaildInput.parentNode.removeChild(input_ei);
    }
  }
}

function invaildEqual(inputNode, inputEIId='', flag=false, message='') {
  var input_ei = document.getElementById(inputEIId);
  if (flag) {
    if (input_ei == null) {
      input_ei = document.createElement('p');
      input_ei.setAttribute('id', inputEIId);
      inputNode.parentNode.appendChild(input_ei);
    }
    input_ei.innerText = message;
  } else {
    if (input_ei != null) {
      inputNode.parentNode.removeChild(input_ei);
    }
  }
}

document.getElementById('password').onchange = (event) => {
  invaildInfo('password', 'password_ei', /^[a-zA-Z0-9!\\\"\#$%&'()*+,-\./:;<=>?\@[\]^_`{|}~]{8,20}$/g, "You need to enter a password");
  document.getElementById('password_ei').classList.add('vaild-info');
}

document.getElementById('confirm_password').onchange = (event) => {
  var password = document.getElementById("password").value;
  var confirm_password = document.getElementById("confirm_password");
  invaildEqual(confirm_password, 'confirm_password_ei', (password !== confirm_password.value), "The password don't match");
  document.getElementById('confirm_password_ei').classList.add('vaild-info');
}

document.getElementById("submit").onclick = (event) => {
  if (document.getElementsByClassName('vaild-info').length > 0) {
    return;
  }
  axios.defaults.headers.post['Access-Control-Allow-Origin'] = '*';
  axios.defaults.withCredentials = true;
  var old_password = document.getElementById("old_password").value;
  var password = document.getElementById("password").value;
  if (username.length == 0 || email.length == 0 || password.length == 0) {
    return;
  }
  axios.post("http://127.0.0.1:8080/user/change", {
    old_password: old_password,
    password: password,
  })
  .then(function (response) {
    console.log(response.data);
  })
  .catch(function (error) {
    console.log(error);
  });
}
  </script>
</body>
</html>